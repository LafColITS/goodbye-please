language: php

sudo: false

php:
  - 7.0

env:
  - WP_VERSION=master WP_MULTISITE=0

before_script:
  - export WP_DEVELOP_DIR=/tmp/wordpress/
  - mkdir -p $WP_DEVELOP_DIR
  - git clone --depth=1 --branch="$WP_VERSION" git://develop.git.wordpress.org/ $WP_DEVELOP_DIR
  - plugin_slug=$(basename $(pwd))
  - plugin_dir=$WP_DEVELOP_DIR/src/wp-content/plugins/$plugin_slug
  - cd ..
  - mv $plugin_slug $plugin_dir
  - cd $WP_DEVELOP_DIR
  - echo $WP_DEVELOP_DIR
  - cp wp-tests-config-sample.php wp-tests-config.php
  - sed -i "s/youremptytestdbnamehere/wordpress_test/" wp-tests-config.php
  - sed -i "s/yourusernamehere/root/" wp-tests-config.php
  - sed -i "s/yourpasswordhere//" wp-tests-config.php
  - sed -i "s/admin@example.org/admin@example.net/" wp-tests-config.php
  - sed -i "s/example.org/localhost/" wp-tests-config.php
  - sed -i "s/example.com/localhost/" $plugin_dir/behat.yml
  - sed -i "s@path/to/wordpress@$WP_DEVELOP_DIR@" $plugin_dir/behat.yml
  - sed -i "s/username:\ admin/username:\ root/" $plugin_dir/behat.yml
  - sed -i "s/password:\ admin/password:\ /" $plugin_dir/behat.yml
  - mysql -e 'CREATE DATABASE wordpress_test;' -uroot
  - cd $plugin_dir
  - composer install

script:
  - vendor/bin/behat
